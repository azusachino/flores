---
title: Java性能调优实战
created: 2023-01-06 08:00:00
modified: 2023-07-18 13:31:24
tags: [Column, Tech, Java]
author: 刘超
read: 19
total: 44
status: doing
---

## 心得

### 扎实的计算机基础

调优的对象不是单一的应用服务，而是错综复杂的系统。应用服务的性能可能与操作系统、网络、数据库等组件相关，所以需要储备计算机组成原理、操作系统、网络协议以及数据库等基础知识。具体的性能问题往往还与传输、计算、存储数据等相关，那还需要储备数据结构、算法以及数学等基础知识。

### 透过源码了解技术本质

深入源码，通过分析来学习、总结一项技术的实现原理和优缺点，这样我们就能更客观地去学习一项技术，还能透过源码来学习牛人的思维方式，收获更好的编码实现方式。

### 追问&总结

## 性能

- 响应时间
- 吞吐量
    - 磁盘
    - 网络
        - CPU
        - 网卡
        - 防火墙

### 性能瓶颈

- CPU
- 内存
- 磁盘I/O
- 网络
- 异常
    - Java 所采用的异常堆栈处理模式
- 数据库
- 锁竞争

### 性能测试报告

- 接口的平均、最大和最小吞吐量
- 响应时间
- 服务器 CPU、内存、I/O、网络I/O使用率
- JVM GC 频率

### 调优策略

1. 代码优化
2. 设计优化
3. 算法优化
4. 时间换空间/空间换时间
5. 参数调优

### Java 程序性能优化

- `String.intern()`
- 正则表达式
    - 少用贪婪模式，多用独占模式
    - 减少分支选择
    - 减少捕获嵌套

## RPC

1. 选择合适的通信协议
2. 使用单一长连接
3. 优化 Socket 通信
4. 自定义报文
5. 调整 Linux TCP 参数设置选项

![[../../images/linux-tcp-options.png]]

## 多线程

![[../../images/java-thread-lock-upgradation.png]]

### Lock / CLH

![[../../images/java-lock-acquire.png]]

### CAS

`LongAdder` 的原理就是降低操作共享变量的并发数，也就是将对单一共享变量的操作压力分散到多个变量值上，将竞争的每个写线程的 value 值分散到一个数组中，不同线程会命中到数组的不同槽中，各个线程只对自己槽中的 value 值进行 CAS 操作，最后在读取值的时候会将原子操作的共享变量与各个分散在数组的 value 值相加，返回一个近似准确的数值。

### Context Switch

![[../../images/java-thread-status-switch.png]]

- 优化 wait/notify 使用，减少上下文切换
- 合理设置线程池大小，避免创建过多线程
- 使用协程实现非阻塞等待
- 减少JVM垃圾回收

## References

- [Java性能调优实战 - 极客时间](https://localhost/#)
